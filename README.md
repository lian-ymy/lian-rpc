# 远程RPC高性能框架

1、**核心架构**：包括消费方调用、序列化器、网络服务器、请求处理器、注册中心、负载均衡器、重试策略、容错策略等模块

2、**消费方调用**：基于JDK动态代理+工厂模式实现消费方调用模块，为指定服务接口类生成可发送HTTP请求的代理对象，实现远程方法的无感知调用

3、**全局配置加载**：使用双检锁单例模式维护全局配置对象，并通过Hutool的Props实现多环境配置文件的加载

4、**接口Mock**：通过JDK动态代理+工厂模式实现，为指定服务接口类生成返回模拟数据的Mock服务对象，便于开发者测试。

5、**多种序列化器实现**：定义序列化器接口，实现了基于JSON、Kryo和Hessian的序列化器，并通过ThreadLocal解决了Kryo的序列化器的线程安全问题

6、**可扩展设计**：使用工厂模式+单例模式简化创建和获取序列化器对象的操作。并通过扫描资源路径+反射自实现了SPI机制，用户可通过编写配置的方式扩展和指定自己的序列化器

7、**注册中心**：基于Etcd云原生中间件实现了高可用的分布式注册中心，利用其层级结构和Jetcd的KvClient存储服务和节点信息，并支持通过SPI机制扩展

8、**注册中心优化**：利用定时任务和Etcd Key的TTL实现服务提供者的心跳检测和续期机制，节点下线一定时间后自动移除注册信息

9、**消费者服务缓存**：使用本地对象维护已获取到的服务提供者节点缓存，相比于每次从注册中心获取，并通过Etcd的Watch机制，监听节点的过期并自动更新缓存

10、**自定义协议**：由于HTTP协议头信息较多，基于Vert.x TCP服务器 + 类Dubbo的紧凑型消息结构（字节数组）自实现了RPC协议，提升网络传输性能

11、**半包粘包问题解决**：基于Vert.x的RecordParser完美解决半包粘包问题，并用装饰这模式封装了TcpBufferHandlerWrapper类，一行代码即可对原有的请求处理器进行增强，提高代码的可维护性

12、**负载均衡器**：为提高服务提供者集群处理能力，实现了一致性Hash、轮询、随机等不同算法的负载均衡器，并通过SPI机制支持开发者自行拓展

13、**重试机制**：为提高消费端调用的稳定性，基于Guava Retrying实现了包括fixedWait等多种重试策略，并通过SPI机制支持开发者自行拓展

14、**容错机制**：为提高系统的稳定性和可用性，设计实现了FailOver、FailBack、FailSafe、FailFast等多种重试策略，并通过SPI机制支持开发者自行扩展

15、**注解驱动**：为降低开发者的使用成本，封装了服务提供者和消费者启动类；并开发了基于注解驱动的Spring Boot Starter，一个注解就能快速注册Bean为服务、以及注入服务调用代理对象



